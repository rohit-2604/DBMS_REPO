CREATE TABLE PUBLISHER (
    NAME VARCHAR2(20) PRIMARY KEY NOT NULL,
    PHONE NUMBER(38),
    ADDRESS VARCHAR2(50)
);
DROP TABLE PUBLISHER;
CREATE TABLE BOOK (
    BOOK_ID NUMBER(38) NOT NULL PRIMARY KEY,
    TITLE VARCHAR2(20),
    PUB_YEAR VARCHAR2(20),
    PUBLISHER_NAME VARCHAR2(20),
    FOREIGN KEY (PUBLISHER_NAME) REFERENCES PUBLISHER(NAME)
);
DROP TABLE BOOK;
CREATE TABLE BOOK_AUTHORS (
    AUTHOR_NAME VARCHAR2(20) NOT NULL,
    BOOK_ID NUMBER(38) NOT NULL,
    PRIMARY KEY (AUTHOR_NAME, BOOK_ID),
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID)
);
DROP TABLE BOOK_AUTHORS;
CREATE TABLE LIBRARY_BRANCH (
    BRANCH_ID NUMBER(38) NOT NULL PRIMARY KEY,
    BRANCH_NAME VARCHAR2(50),
    ADDRESS VARCHAR2(50)
);
DROP TABLE LIBRARY_BRANCH;
CREATE TABLE BOOK_COPIES (
    NO_OF_COPIES NUMBER(38),
    BOOK_ID NUMBER(38) NOT NULL,
    BRANCH_ID NUMBER(38) NOT NULL,
    PRIMARY KEY (BOOK_ID, BRANCH_ID),
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID),
    FOREIGN KEY (BRANCH_ID) REFERENCES LIBRARY_BRANCH(BRANCH_ID)
);
DROP TABLE BOOK_COPIES;
CREATE TABLE CARD (
    CARD_NO NUMBER(38) NOT NULL PRIMARY KEY
);
DROP TABLE CARD;
CREATE TABLE BOOK_LENDING (
    DATE_OUT DATE,
    DUE_DATE DATE,
    BOOK_ID NUMBER(38) NOT NULL,
    BRANCH_ID NUMBER(38) NOT NULL,
    CARD_NO NUMBER(38) NOT NULL,
    SATUS VARCHAR2(20),
    PRIMARY KEY (BOOK_ID, BRANCH_ID, CARD_NO),
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID),
    FOREIGN KEY (BRANCH_ID) REFERENCES LIBRARY_BRANCH(BRANCH_ID),
    FOREIGN KEY (CARD_NO) REFERENCES card_details(CARD_NO)
);
DROP TABLE BOOK_LENDING;

-- Insert data into the PUBLISHER table
INSERT INTO PUBLISHER (NAME, PHONE, ADDRESS) VALUES ('MCGRAW-HILL', 9989076587, 'BANGALORE');
INSERT INTO PUBLISHER (NAME, PHONE, ADDRESS) VALUES ('PEARSON', 9889076565, 'NEWDELHI');
INSERT INTO PUBLISHER (NAME, PHONE, ADDRESS) VALUES ('RANDOM HOUSE', 7455679345, 'HYDERABAD');
INSERT INTO PUBLISHER (NAME, PHONE, ADDRESS) VALUES ('HACHETTE LIVRE', 8970862340, 'CHENNAI');
INSERT INTO PUBLISHER (NAME, PHONE, ADDRESS) VALUES ('GRUPO PLANETA', 7756120238, 'BANGALORE');

-- Insert data into the BOOK table
INSERT INTO BOOK (BOOK_ID, TITLE, PUB_YEAR, PUBLISHER_NAME) VALUES (1, 'DBMS', 'JAN-2017', 'MCGRAW-HILL');
INSERT INTO BOOK (BOOK_ID, TITLE, PUB_YEAR, PUBLISHER_NAME) VALUES (2, 'ADBMS', 'JUN-2016', 'MCGRAW-HILL');
INSERT INTO BOOK (BOOK_ID, TITLE, PUB_YEAR, PUBLISHER_NAME) VALUES (3, 'CN', 'SEP-2016', 'PEARSON');
INSERT INTO BOOK (BOOK_ID, TITLE, PUB_YEAR, PUBLISHER_NAME) VALUES (4, 'CG', 'SEP-2015', 'GRUPO PLANETA');
INSERT INTO BOOK (BOOK_ID, TITLE, PUB_YEAR, PUBLISHER_NAME) VALUES (5, 'OS', 'MAY-2016', 'PEARSON');

-- Insert data into the BOOK_AUTHORS table
INSERT INTO BOOK_AUTHORS (AUTHOR_NAME, BOOK_ID) VALUES ('NAVATHE', 1);
INSERT INTO BOOK_AUTHORS (AUTHOR_NAME, BOOK_ID) VALUES ('NAVATHE', 2);
INSERT INTO BOOK_AUTHORS (AUTHOR_NAME, BOOK_ID) VALUES ('TANENBAUM', 3);
INSERT INTO BOOK_AUTHORS (AUTHOR_NAME, BOOK_ID) VALUES ('EDWARD ANGEL', 4);
INSERT INTO BOOK_AUTHORS (AUTHOR_NAME, BOOK_ID) VALUES ('GALVIN', 5);

-- Insert data into the LIBRARY_BRANCH table
INSERT INTO LIBRARY_BRANCH (BRANCH_ID, BRANCH_NAME, ADDRESS) VALUES (10, 'RR NAGAR', 'BANGALORE');
INSERT INTO LIBRARY_BRANCH (BRANCH_ID, BRANCH_NAME, ADDRESS) VALUES (11, 'RNSIT', 'BANGALORE');
INSERT INTO LIBRARY_BRANCH (BRANCH_ID, BRANCH_NAME, ADDRESS) VALUES (12, 'RAJAJI NAGAR', 'BANGALORE');
INSERT INTO LIBRARY_BRANCH (BRANCH_ID, BRANCH_NAME, ADDRESS) VALUES (13, 'NITTE', 'MANGALORE');
INSERT INTO LIBRARY_BRANCH (BRANCH_ID, BRANCH_NAME, ADDRESS) VALUES (14, 'MANIRAL', 'UDUPI');




-- Insert data into the BOOK_COPIES table
INSERT INTO BOOK_COPIES (NO_OF_COPIES, BOOK_ID, BRANCH_ID) VALUES (10, 1, 10);
INSERT INTO BOOK_COPIES (NO_OF_COPIES, BOOK_ID, BRANCH_ID) VALUES (5, 1, 11);
INSERT INTO BOOK_COPIES (NO_OF_COPIES, BOOK_ID, BRANCH_ID) VALUES (2, 2, 12);
INSERT INTO BOOK_COPIES (NO_OF_COPIES, BOOK_ID, BRANCH_ID) VALUES (5, 2, 13);
INSERT INTO BOOK_COPIES (NO_OF_COPIES, BOOK_ID, BRANCH_ID) VALUES (7, 3, 14);
INSERT INTO BOOK_COPIES (NO_OF_COPIES, BOOK_ID, BRANCH_ID) VALUES (1, 5, 10);
INSERT INTO BOOK_COPIES (NO_OF_COPIES, BOOK_ID, BRANCH_ID) VALUES (3, 4, 11);

-- Insert data into the CARD table 
INSERT INTO CARD (CARD_NO) VALUES (100);
INSERT INTO CARD (CARD_NO) VALUES (101);
INSERT INTO CARD (CARD_NO) VALUES (102);
INSERT INTO CARD (CARD_NO) VALUES (103);
INSERT INTO CARD (CARD_NO) VALUES (104);

-- Insert data into the BOOK_LENDING table
INSERT INTO BOOK_LENDING (DATE_OUT, DUE_DATE, BOOK_ID, BRANCH_ID, CARD_NO, SATUS)
VALUES (TO_DATE('2017-01-01', 'YYYY-MM-DD'), TO_DATE('2017-06-01', 'YYYY-MM-DD'), 1, 10, 100, 'Checked Out');

INSERT INTO BOOK_LENDING (DATE_OUT, DUE_DATE, BOOK_ID, BRANCH_ID, CARD_NO, SATUS)
VALUES (TO_DATE('2017-01-11', 'YYYY-MM-DD'), TO_DATE('2017-03-11', 'YYYY-MM-DD'), 1, 11, 101, 'Returned');

INSERT INTO BOOK_LENDING (DATE_OUT, DUE_DATE, BOOK_ID, BRANCH_ID, CARD_NO, SATUS)
VALUES (TO_DATE('2017-02-21', 'YYYY-MM-DD'), TO_DATE('2017-04-21', 'YYYY-MM-DD'), 2, 12, 102, 'Checked Out');

INSERT INTO BOOK_LENDING (DATE_OUT, DUE_DATE, BOOK_ID, BRANCH_ID, CARD_NO, SATUS)
VALUES (TO_DATE('2017-03-15', 'YYYY-MM-DD'), TO_DATE('2017-07-15', 'YYYY-MM-DD'), 2, 13, 103, 'Checked Out');

INSERT INTO BOOK_LENDING (DATE_OUT, DUE_DATE, BOOK_ID, BRANCH_ID, CARD_NO, SATUS)
VALUES (TO_DATE('2017-04-12', 'YYYY-MM-DD'), TO_DATE('2017-05-12', 'YYYY-MM-DD'), 3, 14, 104, 'Returned');



--1..
SELECT BOOK_ID, CARD_NO 
FROM BOOK_LENDING 
WHERE DUE_DATE = TO_DATE('2017-03-15', 'YYYY-MM-DD');
---2..
ALTER TABLE CARD RENAME TO card_details;
DROP TABLE card_details;
--3..
ALTER TABLE BOOK_LENDING RENAME COLUMN SATUS TO Book_Lending_Table;
--4..
SELECT *
FROM BOOK_COPIES
WHERE NO_OF_COPIES = 5;
--5..
ALTER TABLE LIBRARY_BRANCH RENAME COLUMN ADDRESS TO BRANCH_ADDRESS;
--7..
SELECT BRANCH_NAME, BRANCH_ADDRESS
FROM LIBRARY_BRANCH
WHERE BRANCH_ADDRESS = 'BANGALORE';
--6.
SELECT BL.BOOK_ID, COUNT(*) AS NUM_OF_COPIES_NOT_RETURNED
FROM BOOK_LENDING BL
WHERE BL.Book_Lending_Table = 'Checked Out'
GROUP BY BL.BOOK_ID;
--9..
SELECT BA.AUTHOR_NAME
FROM BOOK B
JOIN BOOK_AUTHORS BA ON B.BOOK_ID = BA.BOOK_ID
WHERE B.TITLE = 'DBMS';
--8..
SELECT P.NAME AS PUBLISHER_NAME
FROM BOOK B
JOIN PUBLISHER P ON B.PUBLISHER_NAME = P.NAME
WHERE B.TITLE = 'DBMS';
--10..
SELECT B.BOOK_ID AS BOOK_CODE, B.TITLE AS BOOK_TITLE, BA.AUTHOR_NAME AS AUTHOR
FROM BOOK B
JOIN BOOK_AUTHORS BA ON B.BOOK_ID = BA.BOOK_ID
WHERE B.TITLE = 'DBMS';

SELECT TABLE_NAME FROM USER_TABLES;

SELECT COLUMN_NAME 
FROM USER_TAB_COLUMNS 
WHERE TABLE_NAME = 'BOOK_LENDING';

SELECT COLUMN_NAME 
FROM USER_TAB_COLUMNS 
WHERE TABLE_NAME = 'LIBRARY_BRANCH';
















